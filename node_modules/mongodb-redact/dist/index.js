"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.redact = redact;
const regexes_1 = require("./regexes");
const utils_1 = require("./utils");
const secrets_1 = require("./secrets");
function redact(message, secrets = undefined) {
    if ((0, utils_1.isPlainObject)(message)) {
        const newMessage = Object.fromEntries(Object.entries(message).map(([key, value]) => [
            key,
            redact(value, secrets),
        ]));
        return Object.setPrototypeOf(newMessage, Object.getPrototypeOf(message));
    }
    if (Array.isArray(message)) {
        return message.map((msg) => redact(msg, secrets));
    }
    if (typeof message !== 'string') {
        return message;
    }
    if (secrets) {
        message = (0, secrets_1.redactSecretsOnString)(message, secrets);
    }
    for (const [regex, replacement] of regexes_1.regexes) {
        message = message.replace(regex, replacement);
    }
    return message;
}
exports.default = redact;
//# sourceMappingURL=index.js.map